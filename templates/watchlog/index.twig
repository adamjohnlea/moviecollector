{% extends "layouts/base.twig" %}

{% block title %}Watchlog - Movie Collector{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">Watchlog</h1>

    {% if items is defined and items|length > 0 %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in items %}
                <a href="/movies/{{ item.tmdb_id }}" class="block bg-white dark:bg-gray-800 rounded-lg shadow hover:bg-gray-50 dark:hover:bg-gray-700 overflow-hidden">
                    <div class="p-4 flex flex-col items-center text-center">
                        {% if item.poster_url %}
                            <img src="{{ item.poster_url }}" alt="{{ item.title }}" class="w-24 h-36 object-cover rounded">
                        {% else %}
                            <div class="w-24 h-36 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center text-xs text-gray-500">No image</div>
                        {% endif %}
                        <div class="mt-3 w-full">
                            <div class="text-base font-semibold text-gray-900 dark:text-gray-100 truncate">{{ item.title }}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                {# Date-only display with server-rendered fallback #}
                                <span x-data="{ tz: '{{ user_timezone }}' }"
                                      x-init="(() => { const el = $el.querySelector('[data-ts]'); if (!el) return; const ts = el.getAttribute('data-ts'); if (!ts) return; let d; if (/^\d{4}-\d{2}-\d{2}$/.test(ts)) { d = new Date(ts + 'T00:00:00Z'); } else { d = new Date(ts.replace(' ', 'T') + 'Z'); } try { el.textContent = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeZone: tz }).format(d); } catch(e) { el.textContent = d.toLocaleDateString(); } })()">
                                    <span>Watched:</span>
                                    <span data-ts="{{ item.watched_at }}">{% if item.watched_at %}{{ item.watched_at|date("F j, Y") }}{% endif %}</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>

        {# Pagination #}
        <div class="mt-6 flex items-center justify-between">
            <div>
                {% if has_prev %}
                    <a href="/watchlog?page={{ page - 1 }}&limit={{ limit }}" class="px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">Previous</a>
                {% endif %}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Page {{ page }}</div>
            <div>
                {% if has_next %}
                    <a href="/watchlog?page={{ page + 1 }}&limit={{ limit }}" class="px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">Next</a>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center text-gray-600 dark:text-gray-400">
            No watched activity yet.
        </div>
    {% endif %}
</div>
{% endblock %}
